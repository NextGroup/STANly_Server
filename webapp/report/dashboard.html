<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Dashboard@STANly</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="STANly@Software Maestro">
    <meta name="author" content="Team STANly">
    <!-- Le styles -->
    <link rel="stylesheet" href="/Stanly/assets/css/bootstrap.css">
    <!--<link rel="stylesheet" href="/Stanly/assets/css/dashboard.css">-->
    <!--<link rel="stylesheet" href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css">-->
    <link rel="stylesheet" href="/Stanly/assets/css/custom-bootstrap-responsive.css">
    <!--<link rel="stylesheet" href="../assets/css/docs.css">-->

    <script type="text/javascript" src="/Stanly/assets/js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" />
    <link rel="stylesheet" href="/Stanly/assets/PackageGraph/css/PackageGraph.css">

    <script type="text/javascript" src="/Stanly/js/utilities.js"></script>

    <style>
        /*@import url(http://bost.ocks.org/mike/style.css?20120608);*/

        #codesize rect {
            /*fill: none;*/
            stroke: #fff;
            /*fill: #e1e1e8;*//*Children Rect Color*/
        }

        #codesize rect.parent,
            .grandparent rect {
            stroke-width: 1px;
            stroke: #000;
            fill: none;
        }

        #codesize .grandparent rect {
            fill: #e1e1e8;
            stroke: #000;
        }

        #codesize .children rect.parent,
        #codesize .grandparent rect {
            cursor: pointer;
        }

        #codesize rect.parent {
            pointer-events: all;
        }

        #codesize .children:hover rect.parent,
        #codesize .grandparent:hover rect {
            fill: #777777;/*마우스 오버 되었을때 색*/
            opacity: 0.5;
        }

    </style>
</head>
<!--사이즈 변경 코드-->
<script type="text/javascript">
    $(window).ready(BoardAlign);
    $(window).resize(BoardAlign);
    //$(BoardAlign);

    function BoardAlign() {
        var sidebarwidth = parseInt($(".span3").css("width"));
        var sidebarmarginleft = parseInt($(".span5").css("margin-left"));
        var containerwidth =parseInt($(window).width());


        var halfgrid5width =  (containerwidth - (sidebarwidth +(sidebarmarginleft*2)))/2- 20;

        $('.span5').css("width", halfgrid5width + "px");
        $('.row').css("width", $('.navbar').width + "px");
    }
</script>
<!-- 하이차트 -->
<body data-spy="scroll" data-target=".bs-docs-sidebar">

<div class="navbar navbar-fixed-top navbar-inverse">
    <div class="navbar-inner">
        <a class="brand" href="#">STANly</a>
            <ul class="nav">
                <li class="active"><a href="javascript:void(0);">DashBoard</a></li>
                <li class="divider-vertical"></li>
                <li><a href="javascript:void(0);" onClick="requestURL('get','./detail/composition.html','Name=' + getProjectName()); return false;">Composition</a></li>
                <li class="divider-vertical"></li>
                <li><a href="javascript:void(0);" onClick="requestURL('get','./detail/pollution.html','Name=' + getProjectName()); return false;">Pollution</a></li>
                <li class="divider-vertical"></li>
                <li><a href="javascript:void(0);" onClick="requestURL('get','./detail/distance.html','Name=' + getProjectName()); return false;">Distance</a></li>
                <li class="divider-vertical"></li>
                <li><a href="javascript:void(0);" onClick="requestURL('get','./detail/metrics.html','Name=' + getProjectName()); return false;">Metrics</a></li>
                <li class="divider-vertical"></li>
                <li><a href="./detail/about.html">About</a></li>
                <li class="divider-vertical"></li>
            </ul>
    </div>
</div>


<div class = "row" style="min-width: 1024px;">

        <div class="span3">
            <!--<div data-spy="affix">-->
            <ul class="nav nav-tabs nav-stacked">
                <li><a href="#composition"><i class="icon-chevron-right"></i>Composition</a></li>
                <li><a href="#pollution"><i class="icon-chevron-right"></i>Pollution</a></li>
                <li><a href="#distance"><i class="icon-chevron-right"></i>Distance</a></li>
                <li><a href="#metrics"><i class="icon-chevron-right"></i>Metrics</a></li>
            </ul>
        </div>


        <div class = "span5" style=" min-width: 390px;">
            <div style="margin-top: 10px;border:1px solid;border-color: #AAAAAA;">
                <div class="subtitle" style="height: 30px;background-color: #149bdf;">Pollution</div>
                <div id="pollution" style="height: 300px; border:1px;"></div>
                <!--오염도 그래프 그리-->
                <script type="text/javascript" src="../Frontend/report/js/RanderPollution.js"></script>
            </div>


            <div style="margin-top: 10px;border:1px solid;border-color: #AAAAAA;">
                <div class="subtitle" style="height: 30px;background-color: #149bdf;">Composition</div>
                <div id="composition" style="margin: 0px;height: 300px;padding-right: 2px;">
                    <svg id="MainSVG">
                        <defs>
                            <marker id="arrowhead"
                                    viewBox="0 0 10 10"
                                    refX="8"
                                    refY="5"
                                    markerUnits="strokeWidth"
                                    markerWidth="8"
                                    markerHeight="5"
                                    orient="auto"
                                    style="fill: #333">
                                <path d="M 0 0 L 10 5 L 0 10 z"></path>
                            </marker>
                        </defs>
                    </svg>
                    <script src="http://d3js.org/d3.v2.min.js"></script>
                    <script src="/Stanly/assets/PackageGraph/js/dagre.js"></script>
                    <script src="/Stanly/assets/PackageGraph/js/PackageGraph.js"></script>
                    <script>

                        var Grapdata = document.querySelector("#inputGraph");
                        var Mainsvg = d3.select("svg");
                        var MainsvgGroup = Mainsvg.append("g").attr("transform", "translate(5, 5)");
                        var MainGraph = new Graph(Mainsvg,MainsvgGroup,"Main","./detail/MainGraph.json");
                        /*
                        var option={
                            minWidth: $('.subtitle').width(),
                            maxWidth: $('.subtitle').width(),
                            minHeight: 300,
                            resize: function(){}
                        }

                        $( "#composition" ).resizable(option);*/
                    </script>
                </div>
            </div>
            <div style="margin-top: 10px;border:1px solid;border-color: #AAAAAA;">
                <div class="subtitle" style="height: 30px;background-color: #149bdf;">Distance</div>
                <div id="distance" style="height: 300px;"></div>
                <script type="text/javascript" src="./js/google_jsapi.js"></script>
                <script type="text/javascript" src="./js/wz_jsgraphics.js"></script>
                <script type="text/javascript" src="./js/RanderDistance.js"></script>
            </div>
            <div id="dummy" style="height: 300px;"></div>
        </div>


        <div class = "span5" style=" min-width: 390px;">
            <div style="margin-top: 10px;border:1px solid;border-color: #AAAAAA;">
                <div class="subtitle" style="height: 30px;background-color: #149bdf;">Metrics</div>
                <div id="metric" style="min-height: 200px;"></div>
            </div>
            <div style="margin-top: 10px;border:1px solid;border-color: #AAAAAA;">
                <div class="subtitle" style="height: 30px;background-color: #149bdf;">Size of Component</div>
                <div id="codesize" style="background-color: #e1e1e8;height: 300px;"></div><!-- 코드사이즈 배경 -->
                <script>
                    //codesize div
                    var csd_root;
                    var csd_margin;
                    var csd_width;
                    var csd_height;
                    var csd_formatNumber;
                    //var csd_transitioning;
                    var csd_x, csd_y;
                    var csd_treemap;
                    var csd_last_d;
                    var csd_svg,csd_grandparent;
                    var csd_transition;
                    $(function(){
                        DrawCodeSize($("#codesize").width(),$("#codesize").height());
                    });
                    $(window).resize(codeSizeResizeFunc);
                    function codeSizeResizeFunc(){
                        var option={
                            minWidth: $('.subtitle').width()-0.5,
                            maxWidth: $('.subtitle').width()-0.5
                        }
                        $( "#codesize" ).resizable(option);
                        $("#codesize").width($('.subtitle').width()-0.5);
                        csd_width = $('.subtitle').width()-0.5;
                        csd_height = $("#codesize").height()-csd_margin.top;
                        if(csd_width == csd_root.dx && csd_width == csd_root.dy)
                            return;
                        csd_x = d3.scale.linear()
                                .domain([0, csd_width])
                                .range([0, csd_width]);

                        csd_y = d3.scale.linear()
                                .domain([0, csd_height])
                                .range([0, csd_height]);
                        //csd_svg
                        d3.select("#codesize").select("svg")
                                .attr("width", csd_width + csd_margin.left + csd_margin.right)
                                .attr("height", csd_height + csd_margin.bottom + csd_margin.top);

                        csd_root.dx = csd_width;
                        csd_root.dy = csd_height;
                        //layout(csd_last_d);
                        layout(csd_root);
                        csd_transition(csd_last_d,-1);
                    }
                    function DrawCodeSize(pallet_width,pallet_height) {

                        var option={
                            minWidth: $('.subtitle').width()-0.5,
                            maxWidth: $('.subtitle').width()-0.5,
                            minHeight: 300,
                            resize: function(event, ui){codeSizeResizeFunc();}
                        }
                        $( "#codesize" ).resizable(option);

                        csd_margin = {top: 20, right: 0, bottom: 0, left: 0};
                        csd_width = pallet_width;
                        csd_height = pallet_height - csd_margin.top - csd_margin.bottom;
                        csd_formatNumber = d3.format(",d");

                        csd_x = d3.scale.linear()
                                .domain([0, csd_width])
                                .range([0, csd_width]);

                        csd_y = d3.scale.linear()
                                .domain([0, csd_height])
                                .range([0, csd_height]);

                        csd_treemap = d3.layout.treemap()
                                .children(function(d, depth) { return depth ? null : d.children; })
                                .sort(function(a, b) { return a.value - b.value; })
                                .ratio(csd_height / csd_width * 0.5 * (1 + Math.sqrt(5)))
                                .round(false);

                        csd_svg = d3.select("#codesize").append("svg")
                                .attr("width", csd_width + csd_margin.left + csd_margin.right)
                                .attr("height", csd_height + csd_margin.bottom + csd_margin.top)
                                .style("margin-left", -csd_margin.left + "px")
                                .style("margin.right", -csd_margin.right + "px")
                                .append("g")
                                .attr("transform", "translate(" + csd_margin.left + "," + csd_margin.top + ")")
                                .style("shape-rendering", "crispEdges");

                        csd_grandparent = csd_svg.append("g")
                                .attr("class", "grandparent");

                        csd_grandparent.append("rect")
                                .attr("y", -csd_margin.top)
                                .attr("width", "100%")
                                .attr("height", csd_margin.top);

                        csd_grandparent.append("text")
                                .attr("x", 6)
                                .attr("y", 6 - csd_margin.top)
                                .attr("dy", ".75em");

                        d3.json("./codesizesample.json", function(root) {
                            csd_root = csd_last_d = root;
                            initialize(root);
                            accumulate(root);
                            layout(root);
                            display(root);
                        });


                    }
                    function initialize(root) {
                        root.x = root.y = 0;
                        root.dx = csd_width;
                        root.dy = csd_height;
                        root.depth = 0;
                    }

                    // Aggregate the values for internal nodes. This is normally done by the
                    // csd_treemap layout, but not here because of our custom implementation.
                    function accumulate(d) {
                        return d.children
                                ? d.value = d.children.reduce(function(p, v) { return p + accumulate(v); }, 0)
                                : d.value;
                    }

                    // Compute the csd_treemap layout recursively such that each group of siblings
                    // uses the same size (1×1) rather than the dimensions of the parent cell.
                    // This optimizes the layout for the current zoom state. Note that a wrapper
                    // object is created for the parent node for each group of siblings so that
                    // the parent’s dimensions are not discarded as we recurse. Since each group
                    // of sibling was laid out in 1×1, we must rescale to fit using absolute
                    // coordinates. This lets us use a viewport to zoom.
                    function layout(d) {
                        if (d.children) {
                            csd_treemap.nodes({children: d.children});
                            d.children.forEach(function(c) {
                                c.x = d.x + c.x * d.dx;
                                c.y = d.y + c.y * d.dy;
                                c.dx *= d.dx;
                                c.dy *= d.dy;
                                c.parent = d;
                                layout(c);
                            });
                        }
                    }

                    function display(d) {
                        csd_grandparent
                                .datum(d.parent)
                                .on("click", transition)
                                .select("text")
                                .text(name(d));

                        var g1 = csd_svg.insert("g", ".grandparent")
                                .datum(d)
                                .attr("class", "depth");

                        var g = g1.selectAll("g")
                                .data(d.children)
                                .enter().append("g");

                        g.filter(function(d) { return d.children; })
                                .classed("children", true)
                                .on("click", transition);

                        g.selectAll(".child")
                                .data(function(d) { return d.children || [d]; })
                                .enter().append("rect")
                                .attr("class", "child")
                                .style("fill",function(d) {
                                    //d.
                                    //return "#" + d.value.toString();
                                    if(Math.round((255 * d.value / d.parent.value)).toString(16).length == 1)
                                        return "#0" + Math.round((255 * d.value / d.parent.value)).toString(16) + "FF00";
                                    return "#" + Math.round((255 * d.value / d.parent.value)).toString(16) + "FF00";
                                    return "#e1e1e1";
                                })
                                .call(rect);

                        g.append("rect")
                                .attr("class", "parent")
                                .call(rect)
                                .append("title")
                                //.style("fill","#FFFFFF")
                                .text(function(d) { return csd_formatNumber(d.value); });

                        g.append("text")
                                .attr("dy", ".75em")
                                .text(function(d) { return d.name; })
                                .call(text);
                        csd_transition = transition;
                        function transition(d,event) {
                            //if (csd_transitioning || !d) return;
                            if(!d)  return;
                            csd_last_d = d;
                            //csd_transitioning = true;

                            //console.log(d);
                            //console.log(csd_transitioning);
                            var g2 = display(d);
                            var duration;
                            if(event != -1) duration = 750;
                            else            duration = 0;

                            var t1 = g1.transition().duration(duration);
                            var t2 = g2.transition().duration(duration);

                            // Update the domain only after entering new elements.
                            csd_x.domain([d.x, d.x + d.dx]);
                            csd_y.domain([d.y, d.y + d.dy]);

                            // Enable anti-aliasing during the transition.
                            csd_svg.style("shape-rendering", null);

                            // Draw child nodes on top of parent nodes.
                            csd_svg.selectAll(".depth").sort(function(a, b) { return a.depth - b.depth; });

                            // Fade-in entering text.
                            g2.selectAll("text").style("fill-opacity", 0);

                            // Transition to the new view.
                            t1.selectAll("text").call(text).style("fill-opacity", 0);
                            t2.selectAll("text").call(text).style("fill-opacity", 1);
                            t1.selectAll("rect").call(rect);
                            t2.selectAll("rect").call(rect);

                            // Remove the old node when the transition is finished.
                            t1.remove().each("end", function() {
                                csd_svg.style("shape-rendering", "crispEdges");
                                //csd_transitioning = false;
                                //console.log(csd_transitioning);
                            });
                        }

                        return g;
                    }

                    function text(text) {
                        text.attr("x", function(d) { return csd_x(d.x) + 6; })
                                .attr("y", function(d) { return csd_y(d.y) + 6; });
                    }

                    function rect(rect) {
                        rect.attr("x", function(d) { return csd_x(d.x); })
                                .attr("y", function(d) { return csd_y(d.y); })
                                .attr("width", function(d) { return csd_x(d.x + d.dx) - csd_x(d.x); })
                                .attr("height", function(d) { return csd_y(d.y + d.dy) - csd_y(d.y); });
                    }

                    function name(d) {
                        return d.parent
                                ? name(d.parent) + "." + d.name
                                : d.name;
                    }
                </script>
            </div>
        </div>
</div>


<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="/Stanly/assets/js/bootstrap.min.js"></script>
<script src="/Stanly/assets/highcharts/js/highcharts.js"></script>
<script src="/Stanly/assets/highcharts/js/modules/exporting.js"></script>
<!--<script>
    $(window).resize(MakeResizable);
    $(MakeResizable);
    function MakeResizable(){
        var option={
            minWidth: $('.subtitle').width(),
            maxWidth: $('.subtitle').width(),
            minHeight: 300,
            resize: function(){codeSizeResizeFunc();console.log("hello");}
        }

        //$( "#metric" ).resizable(option);
        $( "#codesize" ).resizable(option);
        $( "#pollution" ).resizable(option);
        //$( "#composition" ).resizable(option);
        //$( "#distance" ).resizable(option);
    }
</script>-->
</body>
</html>