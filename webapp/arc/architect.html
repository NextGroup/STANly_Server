<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
	
	<title>STANly :: Architect View</title>

	<meta name="viewport" content="width=device-width">

	<link href="../css/style.css" rel="stylesheet" type="text/css">
    <link href="../js/PackageGraph/css/PackageGraph.css" rel="stylesheet" type="text/css">

	<script type="text/javascript" src="../js/jquery-2.0.0.min.js"></script>
	<script type="text/javascript" src="../js/arcadia.js"></script>

    <script type="text/javascript" src="../js/stanlyutils.js"></script>

    <script type="text/javascript" src="../js/jstree/_lib/jquery.cookie.js"></script>
    <script type="text/javascript" src="../js/jstree/_lib/jquery.hotkeys.js"></script>
    <script type="text/javascript" src="../js/jstree/jquery.jstree.js"></script>
    <script type="text/javascript" src="../js/ProjectTree.js"></script>

    <script type="text/javascript">

        $(document).ready(function() {
            draw_project_explorer(getParameter('Project'));
        });


        var table;
        function BuildDetailList(id){
            $.ajax( {
                type :'GET'
                ,asyn :true
                ,url :'/Stanly/component/RelationList'
                ,dataType :"json"
                ,data:{Name:getParameter('Project'),SrcID:id}
                //,contentType :"application/x-www-form-urlencoded;charset=UTF-8"
                ,beforeSend : function(xhr){
                }
                ,success : function(jsonData) {
                    table = jsonData.relation;

                    $('.relations>.content-box').empty();
                    $('.relations>.content-box').append($('<li id="relation-head"><div class="source hover">Source</div><div class="relation hover">Relation</div><div class="target hover">Target</div></li>'));
                    if(table.length < 4)
                    {
                        for(var i=0;i<table.length;i++)
                        {
                            templi = $('<li></li>');
                            templi.append($('<div class="source">'+table[i].Sources+'</div>'));
                            templi.append($('<div class="relation">'+table[i].Relations+'</div>'));
                            templi.append($('<div class="target">'+table[i].Targets+'</div>'));
                            $('.relations>.content-box').append(templi);
                        }
                    }
                    else
                    {
                        for(var i=0;i<3;i++)
                        {
                            templi = $('<li></li>');
                            templi.append($('<div class="source">'+table[i].Sources+'</div>'));
                            templi.append($('<div class="relation">'+table[i].Relations+'</div>'));
                            templi.append($('<div class="target">'+table[i].Targets+'</div>'));
                            $('.relations>.content-box').append(templi);
                        }
                        $('.relations>.content-box').append($('<li class="center">··· '+(table.length-3)+' More ···</li>'));
                    }
                    /*<li>
                     <div class="source">Source</div>
                     <div class="relation">Relation</div>
                     <div class="target">Target</div>
                     </li>
                     <li class="center">··· 125 More ···</li>*/
                }
                ,error : function(xhr, textStatus) {
                }
                ,complete : function(xhr, textStatus) {
                }
            });

            $.ajax({
                type: "get",
                url: "http://localhost:8080/Stanly/linkdev/list",
                data: {name:getParameter('Project'),nsleft:id},
                success: function(json)
                {
                    devs = jQuery.parseJSON(json).list;
                    $('.developer>.title')
                            .text(devs.length)
                            .append($('<span>Members</span>'));

                    $('.developer>.content-box').empty();

                    if(devs.length<4)
                    {
                        for(var i=0;i<devs.length;i++)
                            $('.developer>.content-box').append($('<li>'+devs[i]+'</li>'))
                    }
                    else
                    {
                        for(var i=0;i<3;i++)
                            $('.developer>.content-box').append($('<li>'+devs[i]+'</li>'))
                        $('.developer>.content-box').append($('<li class="center">··· More members ···</li>'))
                    }
                }
            });
        }
    </script>

</head>

<body>
<div id="container" class="architect">
	<div id="content-container">
		<div id="content" style="position: absolute; height: 100%;; min-height: 0px;overflow: hidden">
			<div class="right-content-area" style="margin-right: 0px">
				<table>
					<tbody>
						<tr class="composition-view">
							<td style="width: 50%; border-left: 1px solid rgba(0, 0, 0, 0.05); height:300px">
                                <svg id="MainSVG" style="height:100%">
                                    <defs>
                                        <marker id="arrowhead"
                                                viewBox="0 0 10 10"
                                                refX="8"
                                                refY="5"
                                                markerUnits="strokeWidth"
                                                markerWidth="8"
                                                markerHeight="5"
                                                orient="auto"
                                                style="fill: #333">
                                            <path d="M 0 0 L 10 5 L 0 10 z"></path>
                                        </marker>
                                    </defs>
                                </svg>
                                <script src="/Stanly/js/d3/lib/d3.v2.min.js"></script>
                                <script src="/Stanly/js/PackageGraph/js/dagre.js"></script>
                                <script src="/Stanly/js/PackageGraph/js/PackageGraph.js"></script>
                                <script>
                                    function BuildMainView(id,name){
                                        var backup = $('#MainSVG').find('defs');
                                        $('#MainSVG').empty();
                                        $('#MainSVG').append(backup);
                                        var Grapdata = document.querySelector("#inputGraph");
                                        var Mainsvg = d3.select("svg");
                                        var MainsvgGroup = Mainsvg.append("g").attr("transform", "translate(5, 5)");
                                        var MainGraph = new Graph(Mainsvg,MainsvgGroup,"Main","/Stanly/component/CompositionView?Name="+getParameter('Project')+"&nodeID="+id);
                                    }

                                    $(function(){
                                        BuildMainView(1);
                                    });

                                </script>
							</td>
							<td style="width: 50%; border-left: 1px solid rgba(0, 0, 0, 0.05);"></td>
						</tr>
						<tr class="composition-view">
							<td style="width: 50%; border-left: 1px solid rgba(0, 0, 0, 0.05);"></td>
							<td style="width: 50%; border-left: 1px solid rgba(0, 0, 0, 0.05);"></td>
						</tr>

                        <tr class="information"  style="height: 170px">
                            <td colspan="2">
                                <div class="relations"  style="height: auto;">
                                    <ol class="content-box">
                                        <li id="relation-head">
                                            <div class="source hover">Source</div>
                                            <div class="relation hover">Relation</div>
                                            <div class="target hover">Target</div>
                                        </li>
                                    </ol>
                                </div>
                                <div class="developer">
                                    <div class="icon"></div>
                                    <div class="title">0<span>Members</span></div>
                                    <ol class="content-box">
                                    </ol>
                                </div>
                            </td>
                            <td class="right-white-area"></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="left-hidden-menu">
				<div class="title">Project Explorer</div>
				<div class="explorer-list">
					<!--<div class="content-body" style="margin-top: 63px;">
					</div>-->
                    <div class="content-body" style="height:94%;margin-top:50px;margin-left:5px;margin-right:5px;overflow: auto;">
                    </div>
				</div>
				<div class="right-button"></div>
			</div>
		</div>
		<!--content fin-->
	</div>
	<!--content-container fin-->
</div>

</body>
</html>